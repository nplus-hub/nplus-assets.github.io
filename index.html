<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Asset Manager Pro</title>
    <link rel="icon" href="https://raw.githubusercontent.com/nplus-hub/my-assets/main/glasses-purple-yellow-diamond.png">
    
    <script>
        // --- 設定エリア：ここだけ書き換えてください ---
        const CONFIG = {
            GAS_URL: "https://script.google.com/macros/s/AKfycbyrEPwdf1Y5avpMVv_KjNUpgrxNZaJP3sBn7SmQt5jCyq3kjdU-p9pNFUyTTxfIUbKrig/exec",
            GITHUB: { USER: "nplus-hub", REPO: "my-assets" }
        };
    </script>

    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        :root { --primary: #24292f; --bg: #f0f2f5; --card: #fff; --border: #e1e4e8; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; }
        header { background: var(--primary); color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 20px; font-weight: bold; text-decoration: none; color: white; }
        .container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding: 20px; }
        .card { background: var(--card); border-radius: 12px; border: 1px solid var(--border); height: 380px; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        .preview { height: 240px; background: #eee; position: relative; }
        model-viewer, .preview img, .preview iframe { width: 100%; height: 100%; position: absolute; top: 0; left: 0; border: none; object-fit: contain; z-index: 5; }
        .file-info { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .file-name { font-size: 13px; font-weight: bold; word-break: break-all; }
        .badge { position: absolute; top: 10px; right: 10px; padding: 4px 8px; border-radius: 10px; color: white; font-size: 10px; z-index: 10; }
        .btn { width: 100%; padding: 10px; cursor: pointer; border: 1px solid #ddd; background: #fafbfc; border-radius: 6px; font-weight: bold; }
        .btn-header { color: white; background: none; border: 1px solid white; width: auto; margin-left: 10px; }
    </style>
</head>
<body>

<header>
    <a href="#" class="logo">Asset Manager Pro</a>
    <div>
        <button class="btn btn-header" onclick="window.open(`https://github.com/${CONFIG.GITHUB.USER}/${CONFIG.GITHUB.REPO}/upload/main`, '_blank')">GitHub追加</button>
        <button class="btn btn-header" onclick="location.reload()">Reload</button>
    </div>
</header>

<div id="gallery" class="container"></div>

<script>
    // カード作成関数
    function createCard(name, url, source, color, isDrive = false, fileId = '') {
        const lower = name.toLowerCase();
        let displayUrl = isDrive ? `https://docs.google.com/uc?export=download&id=${fileId}` : url;
        
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
            <div class="preview"><div class="badge" style="background:${color}">${source}</div></div>
            <div class="file-info">
                <div class="file-name">${name}</div>
                <button class="btn" onclick="navigator.clipboard.writeText('${isDrive ? 'https://drive.google.com/uc?export=view&id='+fileId : url}').then(()=>alert('Copy!'))">URLコピー</button>
            </div>`;
        document.getElementById('gallery').appendChild(card);
        const p = card.querySelector('.preview');

        if (lower.endsWith('.glb')) {
            const mv = document.createElement('model-viewer');
            mv.src = displayUrl; mv.setAttribute('auto-rotate', ''); mv.setAttribute('camera-controls', '');
            mv.setAttribute('crossorigin', 'anonymous'); p.appendChild(mv);
        } else if (['png','jpg','jpeg','gif','webp'].some(e => lower.endsWith(e))) {
            const img = document.createElement('img'); img.src = displayUrl; p.appendChild(img);
        } else if (isDrive) {
            const ifr = document.createElement('iframe'); ifr.src = `https://drive.google.com/file/d/${fileId}/preview`; p.appendChild(ifr);
        }
    }

    // データ読み込み
    window.onload = () => {
        // GitHubから取得
        fetch(`https://api.github.com/repos/${CONFIG.GITHUB.USER}/${CONFIG.GITHUB.REPO}/contents/`)
            .then(r => r.json()).then(data => {
                if(Array.isArray(data)) data.forEach(f => f.name !== 'index.html' && f.type === 'file' && createCard(f.name, f.download_url, 'GitHub', '#24292f'));
            });
        // Driveから取得
        fetch(`${CONFIG.GAS_URL}?getFiles=true`).then(r => r.json()).then(data => {
            if(Array.isArray(data)) data.forEach(f => createCard(f.name, '', 'Drive', '#34a853', true, f.id));
        });
    };
</script>
</body>
</html>
